{
  "channel": {
    "@version": "3.11.0",
    "id": "e678dbf5-f021-43dc-84ae-967500d5c31a",
    "nextMetaDataId": 2,
    "name": "Convert HL7 to FHIR Patient - Example 1",
    "description": null,
    "revision": 7,
    "sourceConnector": {
      "@version": "3.11.0",
      "metaDataId": 0,
      "name": "sourceConnector",
      "properties": {
        "@class": "com.mirth.connect.connectors.tcp.TcpReceiverProperties",
        "@version": "3.11.0",
        "pluginProperties": null,
        "listenerConnectorProperties": {
          "@version": "3.11.0",
          "host": "0.0.0.0",
          "port": 6661
        },
        "sourceConnectorProperties": {
          "@version": "3.11.0",
          "responseVariable": "Auto-generate (After source transformer)",
          "respondAfterProcessing": true,
          "processBatch": false,
          "firstResponse": true,
          "processingThreads": 1,
          "resourceIds": {
            "@class": "linked-hash-map",
            "entry": {
              "string": [
                "Default Resource",
                "[Default Resource]"
              ]
            }
          },
          "queueBufferSize": 1000
        },
        "transmissionModeProperties": {
          "@class": "com.mirth.connect.plugins.mllpmode.MLLPModeProperties",
          "pluginPointName": "MLLP",
          "startOfMessageBytes": "0B",
          "endOfMessageBytes": "1C0D",
          "useMLLPv2": false,
          "ackBytes": "06",
          "nackBytes": 15,
          "maxRetries": 2
        },
        "serverMode": true,
        "remoteAddress": null,
        "remotePort": null,
        "overrideLocalBinding": false,
        "reconnectInterval": 5000,
        "receiveTimeout": 0,
        "bufferSize": 65536,
        "maxConnections": 10,
        "keepConnectionOpen": true,
        "dataTypeBinary": false,
        "charsetEncoding": "DEFAULT_ENCODING",
        "respondOnNewConnection": 0,
        "responseAddress": null,
        "responsePort": null
      },
      "transformer": {
        "@version": "3.11.0",
        "elements": {
          "com.mirth.connect.model.IteratorStep": [
            {
              "@version": "3.11.0",
              "name": "For each msg['PID']['PID.3']",
              "sequenceNumber": 0,
              "enabled": true,
              "properties": {
                "target": "msg['PID']['PID.3']",
                "indexVariable": "i",
                "prefixSubstitutions": {
                  "string": [
                    "msg['PID']['PID.3']",
                    "tmp['PID']['PID.3']"
                  ]
                },
                "children": {
                  "com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep": {
                    "@version": "3.11.0",
                    "name": "Create Identifier",
                    "sequenceNumber": "0-0",
                    "enabled": true,
                    "storeAsLocal": true,
                    "mapType": "CHANNEL",
                    "variable": "identifiers",
                    "definition": "Identifier",
                    "model": {
                      "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
                      "usingBuilder": true,
                      "properties": {
                        "@class": "linked-hash-map",
                        "entry": [
                          {
                            "string": "use",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": false,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "usual",
                                "usingEnum": true
                              }
                            }
                          },
                          {
                            "string": "type",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
                                "usingBuilder": true,
                                "properties": {
                                  "@class": "linked-hash-map",
                                  "entry": {
                                    "string": "text",
                                    "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                      "enabled": true,
                                      "properties": {
                                        "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                        "stringValue": "msg['PID']['PID.3'][i]['PID.3.5'].toString()",
                                        "scriptExpression": true
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          {
                            "string": "system",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "msg['PID']['PID.3'][i]['PID.3.4'].toString()",
                                "scriptExpression": true
                              }
                            }
                          },
                          {
                            "string": "value",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "msg['PID']['PID.3'][i]['PID.3.1'].toString()",
                                "scriptExpression": true
                              }
                            }
                          },
                          {
                            "string": "period",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
                                "usingBuilder": true,
                                "properties": {
                                  "@class": "linked-hash-map",
                                  "entry": [
                                    {
                                      "string": "start",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                          "stringValue": "convertToFhirTimestamp(msg['PID']['PID.3'][i]['PID.3.7'].toString())",
                                          "scriptExpression": true
                                        }
                                      }
                                    },
                                    {
                                      "string": "end",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                          "stringValue": "convertToFhirTimestamp(msg['PID']['PID.3'][i]['PID.3.8'].toString())",
                                          "scriptExpression": true
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          }
                        ]
                      }
                    },
                    "fhirVersion": "STU3"
                  }
                }
              }
            },
            {
              "@version": "3.11.0",
              "name": "For each msg['PID']['PID.5']",
              "sequenceNumber": 2,
              "enabled": true,
              "properties": {
                "target": "msg['PID']['PID.5']",
                "indexVariable": "i",
                "prefixSubstitutions": {
                  "string": [
                    "msg['PID']['PID.5']",
                    "tmp['PID']['PID.5']"
                  ]
                },
                "children": {
                  "com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep": {
                    "@version": "3.11.0",
                    "name": "Create HumanName",
                    "sequenceNumber": "2-0",
                    "enabled": true,
                    "storeAsLocal": true,
                    "mapType": "CHANNEL",
                    "variable": "names",
                    "definition": "HumanName",
                    "model": {
                      "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
                      "usingBuilder": true,
                      "properties": {
                        "@class": "linked-hash-map",
                        "entry": [
                          {
                            "string": "use",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "usual",
                                "usingEnum": true
                              }
                            }
                          },
                          {
                            "string": "family",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "msg['PID']['PID.5'][i]['PID.5.1'].toString()",
                                "scriptExpression": true
                              }
                            }
                          },
                          {
                            "string": "given",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.ArrayModel",
                                "usingBuilder": true,
                                "elements": {
                                  "com.mirth.connect.jsonbuilder.shared.models.StringModel": [
                                    {
                                      "stringValue": "msg['PID']['PID.5'][i]['PID.5.2'].toString()",
                                      "scriptExpression": true
                                    },
                                    {
                                      "stringValue": "msg['PID']['PID.5'][i]['PID.5.3'].toString()",
                                      "scriptExpression": true
                                    }
                                  ]
                                }
                              }
                            }
                          },
                          {
                            "string": "prefix",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.ArrayModel",
                                "usingBuilder": true,
                                "elements": {
                                  "com.mirth.connect.jsonbuilder.shared.models.StringModel": {
                                    "stringValue": "msg['PID']['PID.5'][i]['PID.5.5'].toString()",
                                    "scriptExpression": true
                                  }
                                }
                              }
                            }
                          },
                          {
                            "string": "suffix",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.ArrayModel",
                                "usingBuilder": true,
                                "elements": {
                                  "com.mirth.connect.jsonbuilder.shared.models.StringModel": {
                                    "stringValue": "msg['PID']['PID.5'][i]['PID.5.4'].toString()",
                                    "scriptExpression": true
                                  }
                                }
                              }
                            }
                          },
                          {
                            "string": "period",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
                                "usingBuilder": true,
                                "properties": {
                                  "@class": "linked-hash-map",
                                  "entry": [
                                    {
                                      "string": "start",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                          "stringValue": "convertToFhirTimestamp(msg['PID']['PID.5'][i]['PID.5.12'].toString())",
                                          "scriptExpression": true
                                        }
                                      }
                                    },
                                    {
                                      "string": "end",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                          "stringValue": "convertToFhirTimestamp(msg['PID']['PID.5'][i]['PID.5.13'].toString())",
                                          "scriptExpression": true
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          }
                        ]
                      }
                    },
                    "fhirVersion": "STU3"
                  }
                }
              }
            },
            {
              "@version": "3.11.0",
              "name": "For each msg['PID']['PID.9']",
              "sequenceNumber": 3,
              "enabled": true,
              "properties": {
                "target": "msg['PID']['PID.9']",
                "indexVariable": "i",
                "prefixSubstitutions": {
                  "string": [
                    "msg['PID']['PID.9']",
                    "tmp['PID']['PID.9']"
                  ]
                },
                "children": {
                  "com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep": {
                    "@version": "3.11.0",
                    "name": "Create HumanName",
                    "sequenceNumber": "3-0",
                    "enabled": true,
                    "storeAsLocal": true,
                    "mapType": "CHANNEL",
                    "variable": "aliases",
                    "definition": "HumanName",
                    "model": {
                      "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
                      "usingBuilder": true,
                      "properties": {
                        "@class": "linked-hash-map",
                        "entry": [
                          {
                            "string": "use",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "usual",
                                "usingEnum": true
                              }
                            }
                          },
                          {
                            "string": "family",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "msg['PID']['PID.9'][i]['PID.9.1'].toString()",
                                "scriptExpression": true
                              }
                            }
                          },
                          {
                            "string": "given",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.ArrayModel",
                                "usingBuilder": true,
                                "elements": {
                                  "com.mirth.connect.jsonbuilder.shared.models.StringModel": [
                                    {
                                      "stringValue": "msg['PID']['PID.9'][i]['PID.9.2'].toString()",
                                      "scriptExpression": true
                                    },
                                    {
                                      "stringValue": "msg['PID']['PID.9'][i]['PID.9.3'].toString()",
                                      "scriptExpression": true
                                    }
                                  ]
                                }
                              }
                            }
                          },
                          {
                            "string": "prefix",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.ArrayModel",
                                "usingBuilder": true,
                                "elements": {
                                  "com.mirth.connect.jsonbuilder.shared.models.StringModel": {
                                    "stringValue": "msg['PID']['PID.9'][i]['PID.9.5'].toString()",
                                    "scriptExpression": true
                                  }
                                }
                              }
                            }
                          },
                          {
                            "string": "suffix",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.ArrayModel",
                                "usingBuilder": true,
                                "elements": {
                                  "com.mirth.connect.jsonbuilder.shared.models.StringModel": {
                                    "stringValue": "msg['PID']['PID.9'][i]['PID.9.4'].toString()",
                                    "scriptExpression": true
                                  }
                                }
                              }
                            }
                          },
                          {
                            "string": "period",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
                                "usingBuilder": true,
                                "properties": {
                                  "@class": "linked-hash-map",
                                  "entry": [
                                    {
                                      "string": "start",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                          "stringValue": "convertToFhirTimestamp(msg['PID']['PID.9'][i]['PID.9.12'].toString())",
                                          "scriptExpression": true
                                        }
                                      }
                                    },
                                    {
                                      "string": "end",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                          "stringValue": "convertToFhirTimestamp(msg['PID']['PID.9'][i]['PID.9.13'].toString())",
                                          "scriptExpression": true
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          }
                        ]
                      }
                    },
                    "fhirVersion": "STU3"
                  }
                }
              }
            },
            {
              "@version": "3.11.0",
              "name": "For each msg['PID']['PID.13']",
              "sequenceNumber": 4,
              "enabled": true,
              "properties": {
                "target": "msg['PID']['PID.13']",
                "indexVariable": "i",
                "prefixSubstitutions": {
                  "string": [
                    "msg['PID']['PID.13']",
                    "tmp['PID']['PID.13']"
                  ]
                },
                "children": {
                  "com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep": {
                    "@version": "3.11.0",
                    "name": "Create ContactPoint",
                    "sequenceNumber": "4-0",
                    "enabled": true,
                    "storeAsLocal": true,
                    "mapType": "CHANNEL",
                    "variable": "homePhoneNumbers",
                    "definition": "ContactPoint",
                    "model": {
                      "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
                      "usingBuilder": true,
                      "properties": {
                        "@class": "linked-hash-map",
                        "entry": [
                          {
                            "string": "system",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "phone",
                                "usingEnum": true
                              }
                            }
                          },
                          {
                            "string": "value",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "msg['PID']['PID.13'][i]['PID.13.1'].toString()",
                                "scriptExpression": true
                              }
                            }
                          },
                          {
                            "string": "use",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "home",
                                "usingEnum": true
                              }
                            }
                          }
                        ]
                      }
                    },
                    "fhirVersion": "STU3"
                  }
                }
              }
            },
            {
              "@version": "3.11.0",
              "name": "For each msg['PID']['PID.14']",
              "sequenceNumber": 5,
              "enabled": true,
              "properties": {
                "target": "msg['PID']['PID.14']",
                "indexVariable": "i",
                "prefixSubstitutions": {
                  "string": [
                    "msg['PID']['PID.14']",
                    "tmp['PID']['PID.14']"
                  ]
                },
                "children": {
                  "com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep": {
                    "@version": "3.11.0",
                    "name": "Create ContactPoint",
                    "sequenceNumber": "5-0",
                    "enabled": true,
                    "storeAsLocal": true,
                    "mapType": "CHANNEL",
                    "variable": "businessPhoneNumbers",
                    "definition": "ContactPoint",
                    "model": {
                      "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
                      "usingBuilder": true,
                      "properties": {
                        "@class": "linked-hash-map",
                        "entry": [
                          {
                            "string": "system",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "phone",
                                "usingEnum": true
                              }
                            }
                          },
                          {
                            "string": "value",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "msg['PID']['PID.14'][i]['PID.14.1'].toString()",
                                "scriptExpression": true
                              }
                            }
                          },
                          {
                            "string": "use",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "work",
                                "usingEnum": true
                              }
                            }
                          }
                        ]
                      }
                    },
                    "fhirVersion": "STU3"
                  }
                }
              }
            },
            {
              "@version": "3.11.0",
              "name": "For each msg['PID']['PID.11']",
              "sequenceNumber": 6,
              "enabled": true,
              "properties": {
                "target": "msg['PID']['PID.11']",
                "indexVariable": "i",
                "prefixSubstitutions": {
                  "string": [
                    "msg['PID']['PID.11']",
                    "tmp['PID']['PID.11']"
                  ]
                },
                "children": {
                  "com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep": {
                    "@version": "3.11.0",
                    "name": "Create Address",
                    "sequenceNumber": "6-0",
                    "enabled": true,
                    "storeAsLocal": true,
                    "mapType": "CHANNEL",
                    "variable": "addresses",
                    "definition": "Address",
                    "model": {
                      "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
                      "usingBuilder": true,
                      "properties": {
                        "@class": "linked-hash-map",
                        "entry": [
                          {
                            "string": "use",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "convertAddressUse(msg['PID']['PID.11'][i]['PID.11.7'].toString())",
                                "scriptExpression": true
                              }
                            }
                          },
                          {
                            "string": "type",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": false,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "postal",
                                "usingEnum": true
                              }
                            }
                          },
                          {
                            "string": "text",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "(msg['PID']['PID.11'][i]['PID.11.1'].toString() + ' ' + msg['PID']['PID.11'][i]['PID.11.2'].toString() + ' ' + msg['PID']['PID.11'][i]['PID.11.3'].toString() + ' ' + msg['PID']['PID.11'][i]['PID.11.4'].toString() + ' ' + msg['PID']['PID.11'][i]['PID.11.5'].toString() + ' ' + msg['PID']['PID.11'][i]['PID.11.6'].toString()).trim()",
                                "scriptExpression": true
                              }
                            }
                          },
                          {
                            "string": "line",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.ArrayModel",
                                "usingBuilder": true,
                                "elements": {
                                  "com.mirth.connect.jsonbuilder.shared.models.StringModel": [
                                    {
                                      "stringValue": "msg['PID']['PID.11'][i]['PID.11.1'].toString()",
                                      "scriptExpression": true
                                    },
                                    {
                                      "stringValue": "msg['PID']['PID.11'][i]['PID.11.2'].toString()",
                                      "scriptExpression": true
                                    }
                                  ]
                                }
                              }
                            }
                          },
                          {
                            "string": "city",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "msg['PID']['PID.11'][i]['PID.11.3'].toString()",
                                "scriptExpression": true
                              }
                            }
                          },
                          {
                            "string": "district",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "msg['PID']['PID.11'][i]['PID.11.9'].toString()",
                                "scriptExpression": true
                              }
                            }
                          },
                          {
                            "string": "state",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "msg['PID']['PID.11'][i]['PID.11.4'].toString()",
                                "scriptExpression": true
                              }
                            }
                          },
                          {
                            "string": "postalCode",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "msg['PID']['PID.11'][i]['PID.11.5'].toString()",
                                "scriptExpression": true
                              }
                            }
                          },
                          {
                            "string": "country",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "msg['PID']['PID.11'][i]['PID.11.6'].toString()",
                                "scriptExpression": true
                              }
                            }
                          },
                          {
                            "string": "period",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
                                "usingBuilder": true,
                                "properties": {
                                  "@class": "linked-hash-map",
                                  "entry": [
                                    {
                                      "string": "start",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                          "stringValue": "convertToFhirTimestamp(msg['PID']['PID.11'][i]['PID.11.13'].toString())",
                                          "scriptExpression": true
                                        }
                                      }
                                    },
                                    {
                                      "string": "end",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                          "stringValue": "convertToFhirTimestamp(msg['PID']['PID.11'][i]['PID.11.14'].toString())",
                                          "scriptExpression": true
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          }
                        ]
                      }
                    },
                    "fhirVersion": "STU3"
                  }
                }
              }
            },
            {
              "@version": "3.11.0",
              "name": "For each msg['NK1']",
              "sequenceNumber": 7,
              "enabled": true,
              "properties": {
                "target": "msg['NK1']",
                "indexVariable": "i",
                "prefixSubstitutions": {
                  "string": [
                    "msg['NK1']",
                    "tmp['NK1']"
                  ]
                },
                "children": {
                  "com.mirth.connect.model.IteratorStep": {
                    "@version": "3.11.0",
                    "name": "For each msg['NK1'][i]['NK1.5']",
                    "sequenceNumber": "7-0",
                    "enabled": true,
                    "properties": {
                      "target": "msg['NK1'][i]['NK1.5']",
                      "indexVariable": "j",
                      "prefixSubstitutions": {
                        "string": [
                          "msg['NK1'][i]['NK1.5']",
                          "tmp['NK1'][i]['NK1.5']"
                        ]
                      },
                      "children": {
                        "com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep": {
                          "@version": "3.11.0",
                          "name": "Create ContactPoint",
                          "sequenceNumber": "7-0-0",
                          "enabled": true,
                          "storeAsLocal": true,
                          "mapType": "CHANNEL",
                          "variable": "contactHomePhoneNumbers",
                          "definition": "ContactPoint",
                          "model": {
                            "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
                            "usingBuilder": true,
                            "properties": {
                              "@class": "linked-hash-map",
                              "entry": [
                                {
                                  "string": "system",
                                  "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                    "enabled": true,
                                    "properties": {
                                      "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                      "stringValue": "phone",
                                      "usingEnum": true
                                    }
                                  }
                                },
                                {
                                  "string": "value",
                                  "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                    "enabled": true,
                                    "properties": {
                                      "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                      "stringValue": "msg['NK1'][i]['NK1.5'][j]['NK1.5.1'].toString()",
                                      "scriptExpression": true
                                    }
                                  }
                                },
                                {
                                  "string": "use",
                                  "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                    "enabled": true,
                                    "properties": {
                                      "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                      "stringValue": "home",
                                      "usingEnum": true
                                    }
                                  }
                                }
                              ]
                            }
                          },
                          "fhirVersion": "STU3"
                        }
                      }
                    }
                  }
                }
              }
            },
            {
              "@version": "3.11.0",
              "name": "For each msg['NK1']",
              "sequenceNumber": 8,
              "enabled": true,
              "properties": {
                "target": "msg['NK1']",
                "indexVariable": "i",
                "prefixSubstitutions": {
                  "string": [
                    "msg['NK1']",
                    "tmp['NK1']"
                  ]
                },
                "children": {
                  "com.mirth.connect.model.IteratorStep": {
                    "@version": "3.11.0",
                    "name": "For each msg['NK1'][i]['NK1.6']",
                    "sequenceNumber": "8-0",
                    "enabled": true,
                    "properties": {
                      "target": "msg['NK1'][i]['NK1.6']",
                      "indexVariable": "j",
                      "prefixSubstitutions": {
                        "string": [
                          "msg['NK1'][i]['NK1.6']",
                          "tmp['NK1'][i]['NK1.6']"
                        ]
                      },
                      "children": {
                        "com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep": {
                          "@version": "3.11.0",
                          "name": "Create ContactPoint",
                          "sequenceNumber": "8-0-0",
                          "enabled": true,
                          "storeAsLocal": true,
                          "mapType": "CHANNEL",
                          "variable": "contactBusinessPhoneNumbers",
                          "definition": "ContactPoint",
                          "model": {
                            "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
                            "usingBuilder": true,
                            "properties": {
                              "@class": "linked-hash-map",
                              "entry": [
                                {
                                  "string": "system",
                                  "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                    "enabled": true,
                                    "properties": {
                                      "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                      "stringValue": "phone",
                                      "usingEnum": true
                                    }
                                  }
                                },
                                {
                                  "string": "value",
                                  "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                    "enabled": true,
                                    "properties": {
                                      "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                      "stringValue": "msg['NK1'][i]['NK1.6'][j]['NK1.6.1'].toString()",
                                      "scriptExpression": true
                                    }
                                  }
                                },
                                {
                                  "string": "use",
                                  "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                    "enabled": true,
                                    "properties": {
                                      "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                      "stringValue": "work",
                                      "usingEnum": true
                                    }
                                  }
                                }
                              ]
                            }
                          },
                          "fhirVersion": "STU3"
                        }
                      }
                    }
                  }
                }
              }
            },
            {
              "@version": "3.11.0",
              "name": "For each msg['NK1']",
              "sequenceNumber": 9,
              "enabled": true,
              "properties": {
                "target": "msg['NK1']",
                "indexVariable": "i",
                "prefixSubstitutions": {
                  "string": [
                    "msg['NK1']",
                    "tmp['NK1']"
                  ]
                },
                "children": {
                  "com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep": {
                    "@version": "3.11.0",
                    "name": "Create Patient_Contact",
                    "sequenceNumber": "9-0",
                    "enabled": true,
                    "storeAsLocal": true,
                    "mapType": "CHANNEL",
                    "variable": "contacts",
                    "definition": "Patient_Contact",
                    "model": {
                      "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
                      "usingBuilder": true,
                      "properties": {
                        "@class": "linked-hash-map",
                        "entry": [
                          {
                            "string": "relationship",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.ArrayModel",
                                "usingBuilder": true,
                                "elements": {
                                  "com.mirth.connect.jsonbuilder.shared.models.ObjectModel": [
                                    {
                                      "usingBuilder": true,
                                      "properties": {
                                        "@class": "linked-hash-map",
                                        "entry": [
                                          {
                                            "string": "text",
                                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                              "enabled": true,
                                              "properties": {
                                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                                "stringValue": "msg['NK1'][i]['NK1.3']['NK1.3.2'].toString()",
                                                "scriptExpression": true
                                              }
                                            }
                                          },
                                          {
                                            "string": "id",
                                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                              "enabled": true,
                                              "properties": {
                                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                                "stringValue": "msg['NK1'][i]['NK1.3']['NK1.3.1'].toString()",
                                                "scriptExpression": true
                                              }
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "usingBuilder": true,
                                      "properties": {
                                        "@class": "linked-hash-map",
                                        "entry": [
                                          {
                                            "string": "text",
                                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                              "enabled": true,
                                              "properties": {
                                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                                "stringValue": "msg['NK1'][i]['NK1.7']['NK1.7.2'].toString()",
                                                "scriptExpression": true
                                              }
                                            }
                                          },
                                          {
                                            "string": "id",
                                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                              "enabled": true,
                                              "properties": {
                                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                                "stringValue": "msg['NK1'][i]['NK1.7']['NK1.7.1'].toString()",
                                                "scriptExpression": true
                                              }
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          },
                          {
                            "string": "name",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
                                "usingBuilder": true,
                                "properties": {
                                  "@class": "linked-hash-map",
                                  "entry": [
                                    {
                                      "string": "use",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                          "stringValue": "usual",
                                          "usingEnum": true
                                        }
                                      }
                                    },
                                    {
                                      "string": "family",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                          "stringValue": "msg['NK1'][i]['NK1.2']['NK1.2.1'].toString()",
                                          "scriptExpression": true
                                        }
                                      }
                                    },
                                    {
                                      "string": "given",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.ArrayModel",
                                          "usingBuilder": true,
                                          "elements": {
                                            "com.mirth.connect.jsonbuilder.shared.models.StringModel": [
                                              {
                                                "stringValue": "msg['NK1'][i]['NK1.2']['NK1.2.2'].toString()",
                                                "scriptExpression": true
                                              },
                                              {
                                                "stringValue": "msg['NK1'][i]['NK1.2']['NK1.2.3'].toString()",
                                                "scriptExpression": true
                                              }
                                            ]
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "string": "prefix",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.ArrayModel",
                                          "usingBuilder": true,
                                          "elements": {
                                            "com.mirth.connect.jsonbuilder.shared.models.StringModel": {
                                              "stringValue": "msg['NK1'][i]['NK1.2']['NK1.2.5'].toString()",
                                              "scriptExpression": true
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "string": "suffix",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.ArrayModel",
                                          "usingBuilder": true,
                                          "elements": {
                                            "com.mirth.connect.jsonbuilder.shared.models.StringModel": {
                                              "stringValue": "msg['NK1'][i]['NK1.2']['NK1.2.4'].toString()",
                                              "scriptExpression": true
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "string": "period",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
                                          "usingBuilder": true,
                                          "properties": {
                                            "@class": "linked-hash-map",
                                            "entry": [
                                              {
                                                "string": "start",
                                                "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                                  "enabled": true,
                                                  "properties": {
                                                    "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                                    "stringValue": "convertToFhirTimestamp(msg['NK1'][i]['NK1.2']['NK1.2.12'].toString())",
                                                    "scriptExpression": true
                                                  }
                                                }
                                              },
                                              {
                                                "string": "end",
                                                "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                                  "enabled": true,
                                                  "properties": {
                                                    "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                                    "stringValue": "convertToFhirTimestamp(msg['NK1'][i]['NK1.2']['NK1.2.13'].toString())",
                                                    "scriptExpression": true
                                                  }
                                                }
                                              }
                                            ]
                                          }
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          },
                          {
                            "string": "telecom",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.ArrayModel",
                                "stringValue": "combineArrays(contactHomePhoneNumbers, contactBusinessPhoneNumbers)"
                              }
                            }
                          },
                          {
                            "string": "address",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
                                "usingBuilder": true,
                                "properties": {
                                  "@class": "linked-hash-map",
                                  "entry": [
                                    {
                                      "string": "use",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                          "stringValue": "convertAddressUse(msg['NK1'][i]['NK1.4']['NK1.4.7'].toString())",
                                          "scriptExpression": true
                                        }
                                      }
                                    },
                                    {
                                      "string": "type",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": false,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                          "stringValue": "postal",
                                          "usingEnum": true
                                        }
                                      }
                                    },
                                    {
                                      "string": "text",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                          "stringValue": "(msg['NK1'][i]['NK1.4']['NK1.4.1'].toString() + ' ' + msg['NK1'][i]['NK1.4']['NK1.4.2'].toString() + ' ' + msg['NK1'][i]['NK1.4']['NK1.4.3'].toString() + ' ' + msg['NK1'][i]['NK1.4']['NK1.4.4'].toString() + ' ' + msg['NK1'][i]['NK1.4']['NK1.4.5'].toString() + ' ' + msg['NK1'][i]['NK1.4']['NK1.4.6'].toString()).trim()",
                                          "scriptExpression": true
                                        }
                                      }
                                    },
                                    {
                                      "string": "line",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.ArrayModel",
                                          "usingBuilder": true,
                                          "elements": {
                                            "com.mirth.connect.jsonbuilder.shared.models.StringModel": [
                                              {
                                                "stringValue": "msg['NK1'][i]['NK1.4']['NK1.4.1'].toString()",
                                                "scriptExpression": true
                                              },
                                              {
                                                "stringValue": "msg['NK1'][i]['NK1.4']['NK1.4.2'].toString()",
                                                "scriptExpression": true
                                              }
                                            ]
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "string": "city",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                          "stringValue": "msg['NK1'][i]['NK1.4']['NK1.4.3'].toString()",
                                          "scriptExpression": true
                                        }
                                      }
                                    },
                                    {
                                      "string": "district",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                          "stringValue": "msg['NK1'][i]['NK1.4']['NK1.4.9'].toString()",
                                          "scriptExpression": true
                                        }
                                      }
                                    },
                                    {
                                      "string": "state",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                          "stringValue": "msg['NK1'][i]['NK1.4']['NK1.4.4'].toString()",
                                          "scriptExpression": true
                                        }
                                      }
                                    },
                                    {
                                      "string": "postalCode",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                          "stringValue": "msg['NK1'][i]['NK1.4']['NK1.4.5'].toString()",
                                          "scriptExpression": true
                                        }
                                      }
                                    },
                                    {
                                      "string": "country",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                          "stringValue": "msg['NK1'][i]['NK1.4']['NK1.4.6'].toString()",
                                          "scriptExpression": true
                                        }
                                      }
                                    },
                                    {
                                      "string": "period",
                                      "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                        "enabled": true,
                                        "properties": {
                                          "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
                                          "usingBuilder": true,
                                          "properties": {
                                            "@class": "linked-hash-map",
                                            "entry": [
                                              {
                                                "string": "start",
                                                "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                                  "enabled": true,
                                                  "properties": {
                                                    "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                                    "stringValue": "convertToFhirTimestamp(msg['NK1'][i]['NK1.4']['NK1.4.13'].toString())",
                                                    "scriptExpression": true
                                                  }
                                                }
                                              },
                                              {
                                                "string": "end",
                                                "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                                  "enabled": true,
                                                  "properties": {
                                                    "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                                    "stringValue": "convertToFhirTimestamp(msg['NK1'][i]['NK1.4']['NK1.4.14'].toString())",
                                                    "scriptExpression": true
                                                  }
                                                }
                                              }
                                            ]
                                          }
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          },
                          {
                            "string": "gender",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "convertToFhirGender(msg['NK1'][i]['NK1.15']['NK1.15.1'].toString())",
                                "scriptExpression": true
                              }
                            }
                          }
                        ]
                      }
                    },
                    "fhirVersion": "STU3"
                  }
                }
              }
            }
          ],
          "com.mirth.connect.plugins.javascriptstep.JavaScriptStep": [
            {
              "@version": "3.11.0",
              "sequenceNumber": 1,
              "enabled": true,
              "script": "logger.info(\"intermediate break between iterators\");"
            },
            {
              "@version": "3.11.0",
              "name": "Cleanup, and set msg",
              "sequenceNumber": 11,
              "enabled": true,
              "script": "logger.info(\"hello\");\nfor each (descendant in msg.descendants()) {\n\tlogger.info(\"descendant: \" + descendant.toString());\n\tvar name = descendant.name();\n\tif (name) {\n\tlogger.info(\"descendant = \" + descendant.name().toString()); \n\t}\n}\nfor each (child in msg.children()) {\n\tlogger.info(\"child: \" + child.toString());\n\tvar name = child.name();\n\tif (name) {\n\tlogger.info(\"child = \" + child.name().toString());\n\t}\n}\nfor each (descendant in msg['INSURANCE'].descendants()) {\n\tlogger.info(\"descendant: \" + descendant.toString());\n\tvar name = descendant.name();\n\tif (name) {\n\t\tlogger.info(\"descendant.name(): \" + name.toString());\n\t}\n}\n\nmsg = consolidate(cleanupFhirPatient(patient));"
            }
          ],
          "com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep": {
            "@version": "3.11.0",
            "name": "Create Patient",
            "sequenceNumber": 10,
            "enabled": true,
            "storeAsLocal": true,
            "mapType": "CHANNEL",
            "variable": "patient",
            "definition": "Patient",
            "model": {
              "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
              "usingBuilder": true,
              "properties": {
                "@class": "linked-hash-map",
                "entry": [
                  {
                    "string": "resourceType",
                    "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                      "enabled": true,
                      "properties": {
                        "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                        "stringValue": "Patient",
                        "usingEnum": true
                      }
                    }
                  },
                  {
                    "string": "identifier",
                    "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                      "enabled": true,
                      "properties": {
                        "@class": "com.mirth.connect.jsonbuilder.shared.models.ArrayModel",
                        "stringValue": "identifiers"
                      }
                    }
                  },
                  {
                    "string": "name",
                    "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                      "enabled": true,
                      "properties": {
                        "@class": "com.mirth.connect.jsonbuilder.shared.models.ArrayModel",
                        "stringValue": "combineArrays(names, aliases)"
                      }
                    }
                  },
                  {
                    "string": "telecom",
                    "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                      "enabled": true,
                      "properties": {
                        "@class": "com.mirth.connect.jsonbuilder.shared.models.ArrayModel",
                        "stringValue": "combineArrays(homePhoneNumbers, businessPhoneNumbers)"
                      }
                    }
                  },
                  {
                    "string": "gender",
                    "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                      "enabled": true,
                      "properties": {
                        "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                        "stringValue": "convertToFhirGender(msg['PID']['PID.8']['PID.8.1'].toString())",
                        "scriptExpression": true
                      }
                    }
                  },
                  {
                    "string": "birthDate",
                    "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                      "enabled": true,
                      "properties": {
                        "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                        "stringValue": "convertToFhirDate(msg['PID']['PID.7']['PID.7.1'].toString())",
                        "scriptExpression": true
                      }
                    }
                  },
                  {
                    "string": "deceasedBoolean",
                    "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                      "enabled": true,
                      "properties": {
                        "@class": "com.mirth.connect.jsonbuilder.shared.models.BooleanModel",
                        "stringValue": "convertYesNoIndicator(msg['PID']['PID.30']['PID.30.1'].toString())"
                      }
                    }
                  },
                  {
                    "string": "deceasedDateTime",
                    "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                      "enabled": true,
                      "properties": {
                        "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                        "stringValue": "convertToFhirTimestamp(msg['PID']['PID.29']['PID.29.1'].toString())",
                        "scriptExpression": true
                      }
                    }
                  },
                  {
                    "string": "address",
                    "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                      "enabled": true,
                      "properties": {
                        "@class": "com.mirth.connect.jsonbuilder.shared.models.ArrayModel",
                        "stringValue": "addresses"
                      }
                    }
                  },
                  {
                    "string": "maritalStatus",
                    "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                      "enabled": true,
                      "properties": {
                        "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
                        "usingBuilder": true,
                        "properties": {
                          "@class": "linked-hash-map",
                          "entry": {
                            "string": "text",
                            "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                              "enabled": true,
                              "properties": {
                                "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                "stringValue": "msg['PID']['PID.16']['PID.16.1'].toString()",
                                "scriptExpression": true
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  {
                    "string": "multipleBirthBoolean",
                    "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                      "enabled": true,
                      "properties": {
                        "@class": "com.mirth.connect.jsonbuilder.shared.models.BooleanModel",
                        "stringValue": "convertYesNoIndicator(msg['PID']['PID.24']['PID.24.1'].toString())"
                      }
                    }
                  },
                  {
                    "string": "contact",
                    "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                      "enabled": true,
                      "properties": {
                        "@class": "com.mirth.connect.jsonbuilder.shared.models.ArrayModel",
                        "stringValue": "contacts"
                      }
                    }
                  },
                  {
                    "string": "communication",
                    "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                      "enabled": true,
                      "properties": {
                        "@class": "com.mirth.connect.jsonbuilder.shared.models.ArrayModel",
                        "usingBuilder": true,
                        "elements": {
                          "com.mirth.connect.jsonbuilder.shared.models.ObjectModel": {
                            "usingBuilder": true,
                            "properties": {
                              "@class": "linked-hash-map",
                              "entry": {
                                "string": "language",
                                "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                  "enabled": true,
                                  "properties": {
                                    "@class": "com.mirth.connect.jsonbuilder.shared.models.ObjectModel",
                                    "usingBuilder": true,
                                    "properties": {
                                      "@class": "linked-hash-map",
                                      "entry": [
                                        {
                                          "string": "text",
                                          "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                            "enabled": true,
                                            "properties": {
                                              "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                              "stringValue": "msg['PID']['PID.15']['PID.15.2'].toString()",
                                              "scriptExpression": true
                                            }
                                          }
                                        },
                                        {
                                          "string": "id",
                                          "com.mirth.connect.jsonbuilder.shared.models.ObjectProperty": {
                                            "enabled": true,
                                            "properties": {
                                              "@class": "com.mirth.connect.jsonbuilder.shared.models.StringModel",
                                              "stringValue": "msg['PID']['PID.15']['PID.15.1'].toString()",
                                              "scriptExpression": true
                                            }
                                          }
                                        }
                                      ]
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                ]
              }
            },
            "fhirVersion": "STU3"
          }
        },
        "inboundTemplate": {
          "@encoding": "base64"
        },
        "outboundTemplate": {
          "@encoding": "base64"
        },
        "inboundDataType": "HL7V2",
        "outboundDataType": "FHIR",
        "inboundProperties": {
          "@class": "com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties",
          "@version": "3.11.0",
          "serializationProperties": {
            "@class": "com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties",
            "@version": "3.11.0",
            "handleRepetitions": true,
            "handleSubcomponents": true,
            "useStrictParser": false,
            "useStrictValidation": false,
            "stripNamespaces": true,
            "segmentDelimiter": "\\r",
            "convertLineBreaks": true
          },
          "deserializationProperties": {
            "@class": "com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties",
            "@version": "3.11.0",
            "useStrictParser": false,
            "useStrictValidation": false,
            "segmentDelimiter": "\\r"
          },
          "batchProperties": {
            "@class": "com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties",
            "@version": "3.11.0",
            "splitType": "MSH_Segment",
            "batchScript": null
          },
          "responseGenerationProperties": {
            "@class": "com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties",
            "@version": "3.11.0",
            "segmentDelimiter": "\\r",
            "successfulACKCode": "AA",
            "successfulACKMessage": null,
            "errorACKCode": "AE",
            "errorACKMessage": "An Error Occurred Processing Message.",
            "rejectedACKCode": "AR",
            "rejectedACKMessage": "Message Rejected.",
            "msh15ACKAccept": false,
            "dateFormat": "yyyyMMddHHmmss.SSS"
          },
          "responseValidationProperties": {
            "@class": "com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties",
            "@version": "3.11.0",
            "successfulACKCode": "AA,CA",
            "errorACKCode": "AE,CE",
            "rejectedACKCode": "AR,CR",
            "validateMessageControlId": true,
            "originalMessageControlId": "Destination_Encoded",
            "originalIdMapVariable": null
          }
        },
        "outboundProperties": {
          "@class": "com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties",
          "@version": "3.11.0",
          "serializationProperties": {
            "@class": "com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties",
            "@version": "3.11.0",
            "serializationType": "JSON",
            "fhirVersion": "STU3"
          },
          "deserializationProperties": {
            "@class": "com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties",
            "@version": "3.11.0",
            "serializationType": "JSON"
          },
          "batchProperties": {
            "@class": "com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties",
            "@version": "3.11.0",
            "splitType": "JavaScript",
            "batchScript": null
          }
        }
      },
      "filter": {
        "@version": "3.11.0",
        "elements": null
      },
      "transportName": "TCP Listener",
      "mode": "SOURCE",
      "enabled": true,
      "waitForPrevious": true
    },
    "destinationConnectors": {
      "connector": {
        "@version": "3.11.0",
        "metaDataId": 1,
        "name": "Destination 1",
        "properties": {
          "@class": "com.mirth.connect.connectors.vm.VmDispatcherProperties",
          "@version": "3.11.0",
          "pluginProperties": null,
          "destinationConnectorProperties": {
            "@version": "3.11.0",
            "queueEnabled": false,
            "sendFirst": false,
            "retryIntervalMillis": 10000,
            "regenerateTemplate": false,
            "retryCount": 0,
            "rotate": false,
            "includeFilterTransformer": false,
            "threadCount": 1,
            "threadAssignmentVariable": null,
            "validateResponse": false,
            "resourceIds": {
              "@class": "linked-hash-map",
              "entry": {
                "string": [
                  "Default Resource",
                  "[Default Resource]"
                ]
              }
            },
            "queueBufferSize": 1000,
            "reattachAttachments": true
          },
          "channelId": "none",
          "channelTemplate": "${message.encodedData}",
          "mapVariables": null
        },
        "transformer": {
          "@version": "3.11.0",
          "elements": null,
          "inboundDataType": "FHIR",
          "outboundDataType": "FHIR",
          "inboundProperties": {
            "@class": "com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties",
            "@version": "3.11.0",
            "serializationProperties": {
              "@class": "com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties",
              "@version": "3.11.0",
              "serializationType": "JSON",
              "fhirVersion": "STU3"
            },
            "deserializationProperties": {
              "@class": "com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties",
              "@version": "3.11.0",
              "serializationType": "JSON"
            },
            "batchProperties": {
              "@class": "com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties",
              "@version": "3.11.0",
              "splitType": "JavaScript",
              "batchScript": null
            }
          },
          "outboundProperties": {
            "@class": "com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties",
            "@version": "3.11.0",
            "serializationProperties": {
              "@class": "com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties",
              "@version": "3.11.0",
              "serializationType": "JSON",
              "fhirVersion": "STU3"
            },
            "deserializationProperties": {
              "@class": "com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties",
              "@version": "3.11.0",
              "serializationType": "JSON"
            },
            "batchProperties": {
              "@class": "com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties",
              "@version": "3.11.0",
              "splitType": "JavaScript",
              "batchScript": null
            }
          }
        },
        "responseTransformer": {
          "@version": "3.11.0",
          "elements": null,
          "inboundDataType": "FHIR",
          "outboundDataType": "FHIR",
          "inboundProperties": {
            "@class": "com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties",
            "@version": "3.11.0",
            "serializationProperties": {
              "@class": "com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties",
              "@version": "3.11.0",
              "serializationType": "JSON",
              "fhirVersion": "STU3"
            },
            "deserializationProperties": {
              "@class": "com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties",
              "@version": "3.11.0",
              "serializationType": "JSON"
            },
            "batchProperties": {
              "@class": "com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties",
              "@version": "3.11.0",
              "splitType": "JavaScript",
              "batchScript": null
            }
          },
          "outboundProperties": {
            "@class": "com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties",
            "@version": "3.11.0",
            "serializationProperties": {
              "@class": "com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties",
              "@version": "3.11.0",
              "serializationType": "JSON",
              "fhirVersion": "STU3"
            },
            "deserializationProperties": {
              "@class": "com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties",
              "@version": "3.11.0",
              "serializationType": "JSON"
            },
            "batchProperties": {
              "@class": "com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties",
              "@version": "3.11.0",
              "splitType": "JavaScript",
              "batchScript": null
            }
          }
        },
        "filter": {
          "@version": "3.11.0",
          "elements": null
        },
        "transportName": "Channel Writer",
        "mode": "DESTINATION",
        "enabled": true,
        "waitForPrevious": true
      }
    },
    "preprocessingScript": "// Modify the message variable below to pre process data\nreturn message;",
    "postprocessingScript": "// This script executes once after a message has been processed\n// Responses returned from here will be stored as \"Postprocessor\" in the response map\nreturn;",
    "deployScript": "// This script executes once when the channel is deployed\n// You only have access to the globalMap and globalChannelMap here to persist data\nreturn;",
    "undeployScript": "// This script executes once when the channel is undeployed\n// You only have access to the globalMap and globalChannelMap here to persist data\nreturn;",
    "properties": {
      "@version": "3.11.0",
      "clearGlobalChannelMap": true,
      "messageStorageMode": "DEVELOPMENT",
      "encryptData": false,
      "removeContentOnCompletion": false,
      "removeOnlyFilteredOnCompletion": false,
      "removeAttachmentsOnCompletion": false,
      "initialState": "STARTED",
      "storeAttachments": true,
      "metaDataColumns": {
        "metaDataColumn": [
          {
            "name": "SOURCE",
            "type": "STRING",
            "mappingName": "mirth_source"
          },
          {
            "name": "TYPE",
            "type": "STRING",
            "mappingName": "mirth_type"
          }
        ]
      },
      "attachmentProperties": {
        "@version": "3.11.0",
        "type": "None",
        "properties": null
      },
      "resourceIds": {
        "@class": "linked-hash-map",
        "entry": {
          "string": [
            "Default Resource",
            "[Default Resource]"
          ]
        }
      }
    },
    "exportData": {
      "metadata": {
        "enabled": true,
        "lastModified": {
          "time": 1626465839749,
          "timezone": "America/New_York"
        },
        "pruningSettings": {
          "archiveEnabled": true
        }
      },
      "dependentIds": null,
      "dependencyIds": null,
      "channelTags": {
        "channelTag": [
          {
            "id": "801da78a-5e23-458c-8771-2012cc1238f6",
            "name": "FHIR",
            "channelIds": {
              "string": "e678dbf5-f021-43dc-84ae-967500d5c31a"
            },
            "backgroundColor": {
              "red": 255,
              "green": 0,
              "blue": 0,
              "alpha": 255
            }
          },
          {
            "id": "28eda82e-7385-4be1-b540-ed4505f81192",
            "name": "HL7v2",
            "channelIds": {
              "string": "e678dbf5-f021-43dc-84ae-967500d5c31a"
            },
            "backgroundColor": {
              "red": 0,
              "green": 255,
              "blue": 0,
              "alpha": 255
            }
          }
        ]
      }
    }
  }
}
